#+title: 01_core-emacs
#+author: Naoya Yamashita

* about
Emacsのコア部分(Cによる実装)の設定。
標準Elispの設定は =10_standard-elisp.el= により行う。

* core-emacs
** coding system
#+BEGIN_SRC emacs-lisp
(set-language-environment "Japanese")
(set-default-coding-systems   'utf-8-unix)
(prefer-coding-system         'utf-8-unix)
(set-file-name-coding-system  'utf-8-unix)
(set-keyboard-coding-system   'utf-8-unix)
(setq locale-coding-system    'utf-8-unix)
(setq default-process-coding-system '(undecided-dos . utf-8-unix))
#+END_SRC

** backup files
#+BEGIN_SRC emacs-lisp
;; don't create file like *.~
(setq make-backup-files nil)
;; don't create file like .#*
(setq auto-save-default nil)
;; don't create backup file
(setq vc-make-backup-files nil)
;; don't create .saves-Macbook-Air.local~
(setq auto-save-list-file-prefix nil)
;; don't create .#aaa.txt@ -> conao@Macbook-Air.local
(setq create-lockfiles nil)
#+END_SRC

** others
#+BEGIN_SRC emacs-lisp
;; don't show splash screen
(setq inhibit-splash-screen t)

;; question from emacs
(fset 'yes-or-no-p 'y-or-n-p)

;; reload file after renew
(global-auto-revert-mode 1)

;; kill whole line
(setq kill-whole-line t)

;; scroll-step
(setq scroll-step 1)

;; stop beep and flash display
(setq ring-bell-function 'ignore)

;; when occurs garbage collection
(setq gc-cons-threshold (* 128 1024 1024))

;; 右から左に読む言語に対応させないことで描画高速化
(setq-default bidi-display-reordering nil)

;; IME off when focus minibuffer
(when (fboundp 'mac-auto-ascii-mode)
  (mac-auto-ascii-mode 1))
#+END_SRC

* frame settings
#+BEGIN_SRC emacs-lisp
;; frame title
(setq frame-title-format '("emacs " emacs-version))

;;; window setting
;; hide toolbar, scroll-bar
(tool-bar-mode 0)
(scroll-bar-mode 0)

;;; mode-line setting
;; show line number
(line-number-mode t)
;; show column number
(column-number-mode t)
;; show battery force
(display-battery-mode t)
#+END_SRC

* window settings
#+BEGIN_SRC emacs-lisp
;; truncate
(setq-default truncate-lines t)

;; enlighten editing line
(global-hl-line-mode t)

;;; cursor
;; cursor not blink
(blink-cursor-mode 0)

;; hi-light region
(transient-mark-mode)
(setq highlight-nonselected-windows t)

;; temporary hi-light after yank region
(when window-system
  (defadvice yank (after ys:yank-highlight activate)
    (let ((ol (make-overlay (mark t) (point))))
      (overlay-put ol 'face 'highlight)
      (sit-for 1.0)
      (delete-overlay ol)))
  (defadvice yank-pop (after ys:yank-pop-highlight activate)
    (when (eq last-command 'yank)
      (let ((ol (make-overlay (mark t) (point))))
        (overlay-put ol 'face 'highlight)
        (sit-for 1.0)
        (delete-overlay ol)))))

;; open with drag file
(define-key global-map [ns-drag-file] 'ns-find-file)
#+END_SRC

* buffer settings
#+BEGIN_SRC emacs-lisp
;; insert "\", instead "¥"
(define-key global-map [?¥] [?\\])

;; tab width
(setq-default tab-width 4)
(setq-default c-basic-offset 4)
(setq-default indent-tabs-mode nil)

;; delete region, when yank
(delete-selection-mode t)
#+END_SRC

* shortcut settings
#+BEGIN_SRC emacs-lisp
(bind-keys ("C-c a"   . align)
           ("C-c S-a" . align-regexp)
           ("C-c d"   . delete-trailing-whitespace)
           ("C-c b"   . battery)
           ("C-x e"   . eval-last-sexp)
           ("M-r"     . query-replace)
           ("M-c"     . c-mode))

(define-key key-translation-map (kbd "C-h") (kbd "<DEL>"))

;; C-x r f r : save frame configuration
;; C-x r j r : restore frame configuration

;; Cmd-Ctl-d ; open apple's default dicitonaly

(set-face-attribute 'default nil :family "Monaco" :height 120)
(set-fontset-font (frame-parameter nil 'font)
                  'japanese-jisx0208
                  (font-spec :family "Hiragino Kaku Gothic ProN"))
(add-to-list 'face-font-rescale-alist
             '(".*Hiragino Kaku Gothic ProN.*" . 1.2))

(setq custom-file (locate-user-emacs-file "custom.el"))

;; not worn these commands
(put 'downcase-region 'disabled nil)
(put 'upcase-region   'disabled nil)
#+END_SRC
